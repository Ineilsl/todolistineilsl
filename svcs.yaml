- name: This sets up an httpd webserver
  hosts: 127.0.0.1
  connection: local
  become: True
  tasks:
    - name: install php packages
      apt:
        name:
          - php
          - libapache2-mod-php
          - php-mysql
        state: latest
        update_cache: yes
  
    - name: install apache2
      apt: name=apache2 update_cache=yes state=latest

    - name: enabled mod_rewrite
      apache2_module: name=rewrite state=present
      notify:
        - restart apache2
        
    - name: install mysql
      yum:
        name:
           - mariadb-client
           - mariadb-server
           - python-mysqldb
        state: latest
        update_cache: yes

    - name: start mariadb
      service:
        name: mariadb-server
        enabled: true
        state: started
        
    - name: mysql_root_password
      mysql_user:
        login_user: root
        login_password: 123456789
        user: root
        check_implicit_admin: true
        password: 123456789
        host: localhost
        
    - name: remove remote root
      mysql_user:
        check_implicit_admin: true
        login_user: root
        login_password: 123456789
        user: root
        host: localhost
        state: absent
        
  handlers:
    - name: restart apache2
      service: name=apache2 state=restarted
